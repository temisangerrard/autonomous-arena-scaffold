<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Markets Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;1,600;1,700&family=Crimson+Text:ital,wght@0,400;0,600;1,400;1,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/claude-corners.css">
  <script src="/runtime-config.js"></script>
  <style>
    :root {
      --ink: #2c2010;
      --gold: #c69831;
      --edge: rgba(198, 152, 49, 0.3);
      --panel: rgba(253, 248, 237, 0.96);
      --muted: #6e5a35;
      --good: #2f8f5e;
      --bad: #b44d3c;
      --warn: #ad7a24;
      --mono: 'JetBrains Mono', monospace;
      --serif: 'Crimson Text', Georgia, serif;
      --display: 'Cormorant Garamond', 'Crimson Text', Georgia, serif;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at 12% 8%, #fff9ee 0%, #f6efdf 48%, #efe4cc 100%);
      color: var(--ink);
      font-family: var(--serif);
      font-size: 15px;
      line-height: 1.5;
    }
    .page {
      max-width: 1240px;
      margin: 0 auto;
      padding: 22px;
      display: grid;
      gap: 14px;
    }
    .head {
      border: 1px solid var(--edge);
      border-radius: 14px;
      background: var(--panel);
      padding: 16px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    h1 {
      margin: 0;
      font: italic 700 30px/1 var(--display);
      letter-spacing: 0.01em;
    }
    .sub {
      margin: 6px 0 0;
      color: var(--muted);
      font: italic 400 14px/1.5 var(--serif);
      max-width: 860px;
    }
    .status {
      border: 1px solid var(--edge);
      background: var(--panel);
      border-radius: 10px;
      padding: 8px 12px;
      font: 12px/1.4 var(--mono);
      color: var(--muted);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }
    .kpi {
      border: 1px solid var(--edge);
      border-left: 3px solid var(--gold);
      border-radius: 10px;
      background: var(--panel);
      padding: 12px;
    }
    .kpi .label {
      font: 500 11px/1.2 var(--mono);
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.04em;
    }
    .kpi .value {
      margin-top: 5px;
      font: italic 700 26px/1 var(--display);
      color: var(--ink);
    }
    .panel {
      border: 1px solid var(--edge);
      border-radius: 12px;
      background: var(--panel);
      padding: 14px;
      display: grid;
      gap: 12px;
    }
    .panel-heading {
      margin: 0;
      font: italic 600 18px/1 var(--display);
      color: var(--ink);
    }
    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    input, select {
      border-radius: 8px;
      border: 1px solid var(--edge);
      background: rgba(255, 253, 248, 0.95);
      color: var(--ink);
      padding: 7px 10px;
      font: 13px/1.3 var(--serif);
      min-width: 110px;
    }
    input:focus, select:focus {
      outline: none;
      border-color: rgba(198, 152, 49, 0.6);
      box-shadow: 0 0 0 2px rgba(198, 152, 49, 0.12);
    }
    .btn {
      border: 1px solid rgba(198, 152, 49, 0.45);
      border-radius: 8px;
      background: rgba(255, 253, 248, 0.95);
      color: var(--ink);
      padding: 7px 12px;
      font: 500 11px/1 var(--mono);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s;
    }
    .btn:hover { background: rgba(253, 248, 225, 0.95); }
    .btn-gold {
      background: linear-gradient(125deg, rgba(219, 170, 68, 0.9), rgba(184, 132, 30, 0.9));
      color: #241a08;
      border-color: #a97920;
    }
    .btn-gold:hover { filter: brightness(1.06); }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      border-bottom: 1px solid rgba(198, 152, 49, 0.18);
      padding: 9px 8px;
      text-align: left;
      vertical-align: middle;
    }
    th {
      text-transform: uppercase;
      font: 500 11px/1.2 var(--mono);
      color: var(--muted);
      letter-spacing: 0.04em;
    }
    td .question-text {
      font-style: italic;
      font-size: 14px;
      color: var(--ink);
    }
    td .id-text {
      font: 400 10px/1.4 var(--mono);
      color: var(--muted);
      margin-top: 2px;
    }
    .table-wrap {
      overflow: auto;
      max-height: 360px;
      border: 1px solid var(--edge);
      border-radius: 10px;
      background: rgba(255, 253, 248, 0.95);
    }
    .badge {
      border: 1px solid var(--edge);
      border-radius: 999px;
      padding: 3px 8px;
      font: 500 11px/1 var(--mono);
      white-space: nowrap;
      display: inline-block;
    }
    .badge.live { border-color: rgba(47, 143, 94, 0.5); color: var(--good); background: rgba(47, 143, 94, 0.08); }
    .badge.off  { border-color: rgba(180, 77, 60, 0.4);  color: var(--bad);  background: rgba(180, 77, 60, 0.07); }
    .price-yes { color: var(--good); font-family: var(--mono); font-size: 12px; }
    .price-no  { color: var(--bad);  font-family: var(--mono); font-size: 12px; }
    .mono { font-family: var(--mono); font-size: 12px; }
    .cap {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }
    .cap article {
      border: 1px solid var(--edge);
      border-radius: 10px;
      background: var(--panel);
      padding: 12px;
    }
    .cap h3 {
      margin: 0 0 6px;
      font: italic 600 15px/1 var(--display);
      color: var(--ink);
    }
    .cap p {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }
    .experience {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 12px;
    }
    .experience-card {
      border: 1px solid var(--edge);
      border-radius: 10px;
      background: rgba(255, 253, 248, 0.95);
      padding: 12px;
      display: grid;
      gap: 10px;
    }
    .experience-title {
      margin: 0;
      font: italic 700 20px/1 var(--display);
    }
    .narrator {
      border: 1px solid rgba(198, 152, 49, 0.25);
      border-radius: 10px;
      background: linear-gradient(145deg, rgba(255, 249, 234, 0.88), rgba(247, 234, 202, 0.7));
      padding: 10px 11px;
      display: grid;
      gap: 5px;
    }
    .narrator .name {
      font: 600 11px/1 var(--mono);
      color: #8a6725;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .narrator .line {
      font-style: italic;
      color: #4c3a1c;
      font-size: 14px;
      line-height: 1.45;
    }
    .stepper {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .step-pill {
      border: 1px solid var(--edge);
      border-radius: 999px;
      padding: 5px 9px;
      font: 500 11px/1 var(--mono);
      background: rgba(255, 251, 241, 0.96);
      color: var(--muted);
    }
    .step-pill.active {
      border-color: #b68624;
      color: #3c2a0d;
      background: rgba(232, 195, 112, 0.26);
    }
    .play-panel-shell {
      border: 1px solid var(--edge);
      border-radius: 12px;
      background: linear-gradient(155deg, rgba(255, 252, 246, 0.95), rgba(247, 238, 220, 0.9));
      padding: 12px;
      display: grid;
      gap: 10px;
    }
    .station-ui__title {
      font: italic 700 17px/1 var(--display);
      color: #3b2a0d;
    }
    .station-ui__meta {
      border: 1px solid var(--edge);
      border-radius: 8px;
      background: rgba(255, 251, 240, 0.9);
      color: var(--muted);
      padding: 7px 8px;
      font-size: 13px;
    }
    .prediction-sides {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .prediction-side {
      border: 1px solid var(--edge);
      border-radius: 8px;
      padding: 8px 9px;
      font: 500 12px/1 var(--mono);
      cursor: pointer;
      background: rgba(255, 253, 248, 0.96);
    }
    .prediction-side--yes { color: var(--good); }
    .prediction-side--no { color: var(--bad); }
    .prediction-side.selected {
      border-color: #b68624;
      box-shadow: 0 0 0 2px rgba(182, 134, 36, 0.13);
      background: rgba(250, 235, 199, 0.5);
    }
    .timeline {
      max-height: 170px;
      overflow: auto;
      border: 1px solid var(--edge);
      border-radius: 10px;
      background: rgba(255, 253, 248, 0.95);
      padding: 8px 10px;
      display: grid;
      gap: 7px;
    }
    .timeline-item {
      font: 12px/1.4 var(--mono);
      color: #5f4e2f;
      border-left: 2px solid rgba(198, 152, 49, 0.4);
      padding-left: 8px;
    }
    .timeline-item.flash {
      animation: timelineFlash 700ms ease-out;
    }
    @keyframes timelineFlash {
      from { background: rgba(232, 195, 112, 0.2); }
      to { background: transparent; }
    }
    .live-embed {
      border: 1px solid var(--edge);
      border-radius: 10px;
      overflow: hidden;
      background: #1b1711;
      min-height: 380px;
      position: relative;
    }
    .live-embed iframe {
      width: 100%;
      height: 380px;
      border: 0;
      display: block;
    }
    .live-embed__placeholder {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      color: #d7c6a2;
      text-align: center;
      padding: 20px;
      gap: 10px;
      background: radial-gradient(circle at 20% 12%, #312819 0%, #1b1711 65%);
    }
    .ops-only[hidden] { display: none !important; }
    .preview-controls {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    @media (max-width: 980px) {
      .grid, .cap { grid-template-columns: 1fr 1fr; }
      .experience { grid-template-columns: 1fr; }
    }
    @media (max-width: 680px) {
      .grid, .cap { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="page">
    <header class="head">
      <div>
        <h1>Polymarket Admin Lab</h1>
        <p class="sub">Clean control surface for live Polymarket feed, enabled in-app markets, activation toggles, and stake/quote simulation. Built to validate integration outside gameplay UI.</p>
      </div>
      <div class="row">
        <a class="btn" href="/admin">Back To Admin</a>
        <button id="refresh-all" class="btn btn-gold" type="button">Refresh</button>
      </div>
    </header>

    <section id="status" class="status">Loading markets lab...</section>

    <section class="panel">
      <div class="row">
        <h2 class="panel-heading">Game Experience Demo</h2>
        <span class="badge live">Player Preview</span>
      </div>
      <div class="experience">
        <article class="experience-card">
          <h3 class="experience-title">Guided Round Flow</h3>
          <div class="preview-controls">
            <button id="demo-preview-toggle" class="btn" type="button">Player Preview Mode: On</button>
            <select id="demo-outcome">
              <option value="win">Outcome: Win</option>
              <option value="loss">Outcome: Loss</option>
              <option value="refund">Outcome: Refund</option>
            </select>
            <button id="demo-autoplay" class="btn" type="button">Autoplay Sequence</button>
            <button id="demo-reset" class="btn" type="button">Reset</button>
          </div>
          <div class="narrator">
            <div id="demo-narrator-name" class="name">Mara, Market Guide</div>
            <div id="demo-narrator-line" class="line">Welcome to the market terminal. I will walk you through exactly what players experience in the arena.</div>
          </div>
          <div id="demo-stepper" class="stepper"></div>
          <div class="play-panel-shell">
            <div class="station-ui__title">Market Terminal <span class="mono" style="font-size:11px; color:var(--muted);">from /play patterns</span></div>
            <div class="row">
              <label class="mono" for="demo-market">Question</label>
              <select id="demo-market"></select>
              <label class="mono" for="demo-stake">Stake (USDC)</label>
              <input id="demo-stake" type="number" min="1" max="10000" value="10" />
            </div>
            <div class="prediction-sides">
              <button id="demo-buy-yes" class="prediction-side prediction-side--yes" type="button">YES</button>
              <button id="demo-buy-no" class="prediction-side prediction-side--no" type="button">NO</button>
            </div>
            <div id="demo-status" class="station-ui__meta">Choose a market, pick YES/NO, then run the guided sequence.</div>
            <div id="demo-quote" class="station-ui__meta" hidden></div>
            <div id="demo-position" class="station-ui__meta" hidden></div>
            <div class="row">
              <button id="demo-prev" class="btn" type="button">Back Step</button>
              <button id="demo-next" class="btn btn-gold" type="button">Next Step</button>
            </div>
          </div>
          <div id="demo-timeline" class="timeline"></div>
        </article>
        <article class="experience-card">
          <h3 class="experience-title">Live Arena Embed</h3>
          <p class="sub" style="margin:0;">This is the real in-game runtime at <code>/play</code> embedded directly, so you can compare guided flow against actual player experience.</p>
          <div class="live-embed">
            <div id="live-embed-placeholder" class="live-embed__placeholder">
              <div>Load the full Arena preview inside this page.</div>
              <button id="load-live-play" class="btn btn-gold" type="button">Load Embedded /play</button>
            </div>
            <iframe id="live-play-frame" title="Embedded Arena Play Preview" loading="lazy" hidden></iframe>
          </div>
          <div class="row">
            <a class="btn" href="/play" target="_blank" rel="noopener">Open /play full screen</a>
          </div>
        </article>
      </div>
    </section>

    <section class="grid ops-only" id="ops-kpis">
      <article class="kpi"><div class="label">Enabled Markets</div><div class="value" id="kpi-enabled">0</div></article>
      <article class="kpi"><div class="label">Active Markets</div><div class="value" id="kpi-active">0</div></article>
      <article class="kpi"><div class="label">Live API Markets</div><div class="value" id="kpi-live">0</div></article>
      <article class="kpi"><div class="label">Both-Sides Liquidity</div><div class="value" id="kpi-both">0</div></article>
      <article class="kpi"><div class="label">Refund-Only Risk</div><div class="value" id="kpi-risk">0</div></article>
      <article class="kpi"><div class="label">API Access</div><div class="value mono" id="kpi-auth">Public</div></article>
    </section>

    <section class="cap ops-only" id="ops-capabilities">
      <article>
        <h3>What You Can Do</h3>
        <p>Browse live Polymarket feed, search BTC/events, and promote a live market into your enabled list for gameplay.</p>
      </article>
      <article>
        <h3>Activation Controls</h3>
        <p>Toggle market active/inactive, set max wager and spread, then reuse same market immediately in station gameplay.</p>
      </article>
      <article>
        <h3>API Key Requirement</h3>
        <p id="api-key-note">No key needed for public Gamma read endpoints in this setup. Key is only needed if you move to restricted/private data providers.</p>
      </article>
    </section>

    <section class="panel ops-only" id="ops-enabled-markets">
      <div class="row">
        <h2 class="panel-heading">Enabled In-App</h2>
        <button id="sync-markets" class="btn" type="button">Sync From Polymarket</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Question</th>
              <th>Status</th>
              <th>Pricing</th>
              <th>Controls</th>
            </tr>
          </thead>
          <tbody id="enabled-body"></tbody>
        </table>
      </div>
    </section>

    <section class="panel ops-only" id="ops-live-feed">
      <div class="row">
        <h2 class="panel-heading">Live Polymarket Feed</h2>
        <input id="live-query" type="text" placeholder="Search (btc, election, sports)" />
        <select id="live-limit">
          <option value="25">25</option>
          <option value="50" selected>50</option>
          <option value="100">100</option>
          <option value="200">200</option>
        </select>
        <button id="refresh-live" class="btn" type="button">Load Live Feed</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Question</th>
              <th>Category</th>
              <th>Price</th>
              <th>Close</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="live-body"></tbody>
        </table>
      </div>
    </section>

    <section class="panel ops-only" id="ops-stake-sim">
      <h2 class="panel-heading">Stake Simulator</h2>
      <div class="row">
        <select id="sim-market"></select>
        <select id="sim-side">
          <option value="yes">YES</option>
          <option value="no">NO</option>
        </select>
        <input id="sim-stake" type="number" min="1" max="10000" step="1" value="10" />
        <button id="sim-run" class="btn btn-gold" type="button">Simulate Quote</button>
      </div>
      <div id="sim-output" class="status">Select an enabled market and run simulation.</div>
    </section>
  </main>

  <script type="module" src="/js/admin-markets-lab.js"></script>
</body>
</html>
