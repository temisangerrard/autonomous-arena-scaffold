<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arena Play</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&family=EB+Garamond:wght@400;500&display=swap" rel="stylesheet">
  <script src="/runtime-config.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    :root {
      --ui-coral: #ff7f7f;
      --ui-peach: #ffcba4;
      --ui-mint: #98fb98;
      --ui-lavender: #e6e6fa;
      --ui-gold: #ffd700;
      --ui-cream: #fdf5e6;
      --ui-dark: #1e1e1e;
      --ui-success: #22c55e;
      --ui-error: #ef4444;
      --ui-info: #3b82f6;
      --ui-warning: #f59e0b;
    }
    .canvas-shell { position: fixed; inset: 0; }
    #scene { width: 100vw; height: 100vh; display: block; }

    /* ============================================
       ONBOARDING TUTORIAL OVERLAY
       ============================================ */
    .onboarding-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 12, 8, 0.92);
      z-index: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .onboarding-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    .onboarding-card {
      width: min(540px, calc(100vw - 32px));
      background: linear-gradient(145deg, rgba(253, 248, 237, 0.98), rgba(255, 252, 245, 0.95));
      border: 2px solid rgba(201, 162, 39, 0.5);
      border-radius: 20px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
      padding: 28px;
      color: #2c2416;
      text-align: center;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }
    .onboarding-overlay.visible .onboarding-card {
      transform: scale(1);
    }
    .onboarding__progress {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    .onboarding__dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(201, 162, 39, 0.3);
      transition: all 0.3s ease;
    }
    .onboarding__dot.active {
      background: var(--ui-gold);
      box-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
      transform: scale(1.2);
    }
    .onboarding__dot.completed {
      background: var(--ui-success);
    }
    .onboarding__icon {
      font-size: 48px;
      margin-bottom: 16px;
      line-height: 1;
    }
    .onboarding__title {
      font: 700 28px/1.2 'Cormorant Garamond', serif;
      color: #2c2416;
      margin-bottom: 12px;
    }
    .onboarding__desc {
      font: 16px/1.5 'Crimson Text', serif;
      color: #5a4d3a;
      margin-bottom: 20px;
    }
    .onboarding__keys {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    .onboarding__key {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .onboarding__key-btn {
      width: 52px;
      height: 52px;
      border-radius: 10px;
      border: 2px solid rgba(201, 162, 39, 0.5);
      background: linear-gradient(180deg, #fff 0%, #f5f0e0 100%);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 0 #fff inset;
      font: 700 18px/1 'IBM Plex Mono', monospace;
      color: #3a2f1a;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .onboarding__key-label {
      font: 600 11px/1 'Crimson Text', serif;
      color: #8c7d68;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .onboarding__actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .onboarding__btn {
      min-width: 120px;
      height: 44px;
      border-radius: 12px;
      border: none;
      font: 700 14px/1 'Crimson Text', serif;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .onboarding__btn--primary {
      background: linear-gradient(135deg, #d4a84b 0%, #c49a38 100%);
      color: #1a1408;
      box-shadow: 0 4px 16px rgba(201, 162, 39, 0.4);
    }
    .onboarding__btn--primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(201, 162, 39, 0.5);
    }
    .onboarding__btn--secondary {
      background: transparent;
      border: 2px solid rgba(201, 162, 39, 0.4);
      color: #6a5a38;
    }
    .onboarding__btn--secondary:hover {
      background: rgba(201, 162, 39, 0.1);
    }
    .onboarding__skip {
      margin-top: 16px;
      font: 13px/1 'Crimson Text', serif;
      color: #8c7d68;
    }
    .onboarding__skip a {
      color: #a68523;
      text-decoration: underline;
      cursor: pointer;
    }

    /* ============================================
       MINIMAL TOP HUD
       ============================================ */
    #hud {
      position: fixed;
      top: 16px;
      left: 16px;
      right: 16px;
      height: 48px;
      padding: 0 12px;
      border-radius: 12px;
      background: rgba(20, 18, 14, 0.85);
      border: 1px solid rgba(255, 203, 164, 0.25);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      color: #f8f5ef;
      font: 12px/1.3 'Inter', 'SF Pro Display', sans-serif;
      z-index: 50;
      backdrop-filter: blur(12px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    #hud.hidden {
      transform: translateY(-70px);
      opacity: 0;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .topbar-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--ui-coral) 0%, #ff9a76 100%);
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .topbar-name {
      font: 600 14px/1 'Inter', 'SF Pro Display', sans-serif;
      color: #fff;
      max-width: 140px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .topbar-pills {
      display: flex;
      gap: 8px;
    }

    .topbar-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 5px 10px;
      font: 600 11px/1 'JetBrains Mono', monospace;
      transition: all 0.2s ease;
    }

    .topbar-pill.wallet {
      background: rgba(34, 197, 94, 0.15);
      border: 1px solid rgba(34, 197, 94, 0.4);
      color: #86efac;
    }
    .topbar-pill.wallet:hover {
      background: rgba(34, 197, 94, 0.25);
    }

    .topbar-pill.streak {
      background: rgba(245, 158, 11, 0.15);
      border: 1px solid rgba(245, 158, 11, 0.4);
      color: #fcd34d;
    }
    .topbar-pill.streak:hover {
      background: rgba(245, 158, 11, 0.25);
    }

    .menu-ghost {
      border-radius: 10px;
      border: 1px solid rgba(255, 203, 164, 0.3);
      background: rgba(255, 255, 255, 0.05);
      color: #f6d8be;
      width: 40px;
      height: 32px;
      font: 700 18px/1 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .menu-ghost:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 203, 164, 0.5);
    }
    .menu-ghost:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }

    .menu-pop {
      position: fixed;
      right: 16px;
      top: 72px;
      width: 180px;
      border-radius: 12px;
      border: 1px solid rgba(255, 203, 164, 0.35);
      background: rgba(24, 22, 18, 0.95);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4);
      z-index: 90;
      display: none;
      padding: 8px;
      backdrop-filter: blur(12px);
    }
    .menu-pop.open { display: grid; gap: 4px; }
    .menu-pop button {
      border-radius: 8px;
      border: 1px solid transparent;
      background: transparent;
      color: #f6d8be;
      min-height: 40px;
      font: 600 12px/1 'Inter', sans-serif;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
      padding: 0 12px;
    }
    .menu-pop button:hover {
      border-color: rgba(255, 203, 164, 0.3);
      background: rgba(255, 255, 255, 0.05);
    }
    .menu-pop button:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: -2px;
    }

    /* ============================================
       CONTEXTUAL CHALLENGE PANEL (Hidden by default)
       ============================================ */
    .challenge-panel {
      position: fixed;
      left: 16px;
      bottom: 16px;
      width: min(92vw, 300px);
      border-radius: 12px;
      background: rgba(20, 18, 14, 0.92);
      border: 2px solid transparent;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
      padding: 14px;
      z-index: 60;
      color: #fff;
      opacity: 0;
      transform: translateX(-20px) scale(0.95);
      pointer-events: none;
      transition: all 0.25s ease;
      backdrop-filter: blur(12px);
    }
    .challenge-panel.active {
      opacity: 1;
      transform: translateX(0) scale(1);
      pointer-events: auto;
      border-color: var(--ui-mint);
    }
    .challenge-panel.incoming {
      border-color: var(--ui-gold);
      animation: pulse-border 1.5s ease-in-out infinite;
    }
    @keyframes pulse-border {
      0%, 100% { border-color: var(--ui-gold); }
      50% { border-color: var(--ui-coral); }
    }

    .challenge-panel h2 {
      margin: 0;
      font: 700 13px/1.2 'Inter', 'SF Pro Display', sans-serif;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ui-mint);
    }

    .challenge-panel__head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255, 203, 164, 0.2);
      padding-bottom: 10px;
      margin-bottom: 10px;
    }

    .desk-toggle {
      width: auto;
      border: 1px solid rgba(255, 203, 164, 0.35);
      background: rgba(255, 255, 255, 0.08);
      color: #f8d2ad;
      border-radius: 999px;
      font: 700 10px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .desk-toggle:hover {
      background: rgba(255, 255, 255, 0.12);
    }
    .desk-toggle:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }

    .challenge-panel__body {
      display: block;
    }

    .challenge-panel.compact .challenge-panel__body {
      display: none;
    }

    .challenge-panel.compact {
      width: 220px;
    }

    .pill-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .pill {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(201, 162, 39, 0.3);
      background: rgba(255, 255, 255, 0.08);
      font: 600 10px/1.1 var(--font-mono);
      color: #d4c4a0;
      letter-spacing: 0.03em;
      transition: all 0.2s ease;
    }
    .pill:hover {
      background: rgba(255, 255, 255, 0.12);
    }

    .status-line {
      margin-bottom: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(201, 162, 39, 0.25);
      background: rgba(255, 255, 255, 0.06);
      font: 13px/1.4 'EB Garamond', serif;
      color: #e8e0d0;
      min-height: 40px;
    }

    .challenge-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 14px;
    }

    .challenge-grid label,
    .challenge-panel label {
      display: block;
      font: 600 11px/1.2 'Cormorant Garamond', serif;
      color: #a89870;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .challenge-panel select,
    .challenge-panel input {
      width: 100%;
      border-radius: 8px;
      border: 1px solid rgba(255, 203, 164, 0.25);
      background: rgba(10, 10, 10, 0.5);
      color: #fff;
      padding: 10px 12px;
      font: 13px/1.3 'Inter', sans-serif;
      transition: all 0.2s ease;
    }
    .challenge-panel select:focus,
    .challenge-panel input:focus {
      outline: none;
      border-color: var(--ui-gold);
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.15);
    }

    .challenge-panel button {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--ui-peach);
      background: linear-gradient(135deg, var(--ui-coral) 0%, #ff9090 100%);
      color: #fff;
      padding: 11px 14px;
      font: 600 12px/1.2 'Inter', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .challenge-panel button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(255, 127, 127, 0.4);
    }
    .challenge-panel button:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }
    .challenge-panel button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .challenge-panel .row { margin-bottom: 14px; }

    .challenge-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 14px;
    }

    .side-controls-note {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(201, 162, 39, 0.18);
      background: rgba(255, 255, 255, 0.04);
      color: #a09080;
      font: 12px/1.4 'Crimson Text', serif;
    }

    /* ============================================
       WORLD MAP PANEL (Compact by default)
       ============================================ */
    .world-map-panel {
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: 140px;
      border-radius: 12px;
      background: rgba(20, 18, 14, 0.9);
      border: 2px solid rgba(255, 203, 164, 0.3);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
      padding: 10px;
      z-index: 70;
      transition: all 0.25s ease;
      opacity: 0.9;
      backdrop-filter: blur(10px);
    }
    .world-map-panel:hover {
      width: 280px;
      opacity: 1;
    }
    .world-map-panel.collapsed {
      width: 48px;
      height: 48px;
      padding: 8px;
      border-radius: 50%;
      cursor: pointer;
    }
    .world-map-panel.collapsed:hover {
      width: 48px;
      height: 48px;
    }

    .world-map-title {
      font: 600 11px/1 var(--font-mono);
      color: #a89870;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .map-legend {
      display: flex;
      gap: 10px;
      font: 600 10px/1 var(--font-mono);
      color: #a89870;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .map-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 4px;
      vertical-align: middle;
    }

    #world-map {
      width: 100%;
      height: 120px;
      border-radius: 10px;
      border: 1px solid rgba(255, 203, 164, 0.25);
      background: rgba(0, 0, 0, 0.3);
      display: block;
    }

    /* ============================================
       INTERACTION PROMPT (Center bottom)
       ============================================ */
    .interaction-prompt {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100px;
      z-index: 135;
      display: none;
      padding: 12px 20px;
      border-radius: 999px;
      border: 1px solid rgba(201, 162, 39, 0.4);
      background: rgba(253, 248, 237, 0.96);
      color: #4a3612;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
      font: 700 14px/1.2 'Crimson Text', serif;
      letter-spacing: 0.02em;
      backdrop-filter: blur(8px);
      animation: float-prompt 2s ease-in-out infinite;
    }
    .interaction-prompt.visible { display: block; }
    @keyframes float-prompt {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-4px); }
    }

    .interaction-prompt__key {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(201, 162, 39, 0.2);
      border-radius: 4px;
      font: 700 12px/1 'IBM Plex Mono', monospace;
      margin: 0 2px;
    }

    /* ============================================
       INTERACTION CARD (Expanded interaction)
       ============================================ */
    .interaction-card {
      position: fixed;
      left: 50%;
      bottom: 120px;
      transform: translateX(-50%);
      width: min(380px, calc(100vw - 32px));
      background: rgba(253, 248, 237, 0.98);
      border: 1px solid rgba(198, 152, 49, 0.45);
      border-radius: 16px;
      box-shadow: 0 20px 50px rgba(25, 20, 10, 0.3);
      z-index: 55;
      display: none;
      backdrop-filter: blur(12px);
    }
    .interaction-card.open {
      display: block;
      animation: slide-up 0.25s ease-out;
    }
    @keyframes slide-up {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    .interaction-card__head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px 10px;
    }

    .interaction-card__title {
      font: 700 15px/1.1 'Cormorant Garamond', serif;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #3b2b12;
    }

    .interaction-card__close {
      border: 1px solid rgba(198, 152, 49, 0.3);
      background: rgba(255, 255, 255, 0.8);
      width: 28px;
      height: 28px;
      border-radius: 10px;
      cursor: pointer;
      color: #5a3f16;
      font: 700 18px/1 'IBM Plex Sans', sans-serif;
      transition: all 0.2s ease;
    }
    .interaction-card__close:hover {
      background: rgba(255, 200, 200, 0.5);
    }
    .interaction-card__close:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }

    .interaction-card__body {
      padding: 12px 16px 16px;
      display: grid;
      gap: 12px;
    }

    .station-ui {
      border: 1px solid rgba(198, 152, 49, 0.25);
      background: rgba(255, 255, 255, 0.72);
      border-radius: 12px;
      padding: 12px;
      display: grid;
      gap: 10px;
    }

    .station-ui__title {
      font: 800 12px/1 var(--font-mono);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #5a3f16;
    }

    .station-ui__row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items: center;
    }

    .station-ui__row label {
      font: 700 11px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #6a5835;
    }

    .station-ui__actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .station-ui__meta {
      font: 600 12px/1.35 'IBM Plex Sans', sans-serif;
      color: rgba(44, 33, 18, 0.9);
    }

    .interaction-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items: center;
    }

    .interaction-row label {
      font: 700 11px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #6a5835;
    }

    .interaction-row select,
    .interaction-row input {
      height: 38px;
      border-radius: 10px;
      border: 1px solid rgba(163, 128, 40, 0.35);
      background: rgba(255, 255, 255, 0.85);
      padding: 0 12px;
      font: 600 13px/1 'IBM Plex Sans', sans-serif;
      color: #2c2112;
      transition: all 0.2s ease;
    }
    .interaction-row select:focus,
    .interaction-row input:focus {
      outline: none;
      border-color: var(--ui-gold);
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.15);
    }

    .interaction-actions {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .btn-gold {
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(153, 113, 18, 0.5);
      background: linear-gradient(180deg, #e8c860 0%, #d4a830 100%);
      color: #241a07;
      font: 800 13px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-gold:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(212, 168, 48, 0.4);
    }
    .btn-gold:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }

    .btn-ghost {
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(163, 128, 40, 0.35);
      background: rgba(255, 255, 255, 0.6);
      color: #5a3f16;
      font: 800 12px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      cursor: pointer;
      padding: 0 14px;
      transition: all 0.2s ease;
    }
    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.8);
    }
    .btn-ghost:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }

    .interaction-hint {
      font: 12px/1.4 'Crimson Text', serif;
      color: rgba(60, 44, 18, 0.7);
    }

    /* ============================================
       MATCH CONTROLS (Center bottom - main gameplay)
       ============================================ */
    .match-controls {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      width: min(94vw, 500px);
      border-radius: 16px;
      background: rgba(253, 248, 237, 0.98);
      border: 2px solid rgba(201, 162, 39, 0.45);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
      padding: 16px;
      z-index: 130;
      display: none;
      backdrop-filter: blur(12px);
    }
    .match-controls.visible {
      display: block;
      animation: slide-up 0.3s ease-out;
    }

    .match-controls__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .match-controls__title {
      font: 700 18px/1.2 var(--font-display);
      color: #7e6117;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .match-controls__badge {
      padding: 4px 10px;
      border-radius: 999px;
      font: 700 10px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .match-controls__badge--incoming {
      background: rgba(245, 158, 11, 0.2);
      color: #b45309;
    }
    .match-controls__badge--active {
      background: rgba(34, 197, 94, 0.2);
      color: #15803d;
    }

    .match-controls__status {
      font: 15px/1.4 var(--font-primary);
      color: #4a3f32;
      margin-bottom: 14px;
      padding: 10px 12px;
      background: rgba(0, 0, 0, 0.03);
      border-radius: 8px;
    }

    .match-controls__actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .match-controls__actions.two { grid-template-columns: repeat(2, 1fr); }

    .match-controls__actions button {
      border-radius: 12px;
      border: 1px solid rgba(180, 143, 39, 0.4);
      background: linear-gradient(135deg, #e8c860 0%, #d4a830 50%, #c89820 100%);
      color: #1a1408;
      padding: 14px 12px;
      font: 700 14px/1.1 var(--font-display);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .match-controls__actions button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(212, 168, 48, 0.4);
    }
    .match-controls__actions button:focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }
    .match-controls__actions button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      filter: grayscale(0.3);
    }

    .match-controls__counter {
      margin-top: 12px;
      display: none;
      grid-template-columns: 1fr auto;
      gap: 10px;
    }
    .match-controls__counter.visible { display: grid; }
    .match-controls__counter input {
      min-height: 42px;
      border-radius: 10px;
      border: 1px solid rgba(180, 143, 39, 0.5);
      background: rgba(255, 251, 242, 0.95);
      padding: 0 12px;
      font: 700 14px/1.1 var(--font-display);
      color: #3a2f1a;
    }
    .match-controls__counter input:focus {
      outline: none;
      border-color: var(--ui-gold);
    }
    .match-controls__counter button {
      min-height: 42px;
      border-radius: 10px;
      border: 1px solid rgba(180, 143, 39, 0.5);
      background: linear-gradient(135deg, #f5d266 0%, #e0b840 100%);
      color: #2b2213;
      padding: 0 16px;
      font: 700 13px/1.1 var(--font-display);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .match-controls__counter button:hover {
      transform: translateY(-1px);
    }
    .match-controls__counter button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ============================================
       GAME MODAL (Results / Incoming)
       ============================================ */
    .game-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(15, 12, 8, 0.85);
      z-index: 200;
      backdrop-filter: blur(8px);
    }
    .game-modal.visible { display: flex; }

    .game-card {
      width: min(92vw, 480px);
      border-radius: 20px;
      background: linear-gradient(145deg, rgba(255, 252, 244, 0.98), rgba(253, 248, 237, 0.95));
      border: 2px solid rgba(201, 162, 39, 0.45);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.3);
      padding: 24px;
      color: #2c2416;
      text-align: center;
      animation: modal-in 0.3s ease-out;
    }
    @keyframes modal-in {
      from { opacity: 0; transform: scale(0.95) translateY(20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .game-card h3 {
      margin: 0 0 12px;
      font: 700 28px/1.1 var(--font-display);
      color: #a68523;
    }

    .game-card p { margin: 10px 0; font: 16px/1.5 var(--font-primary); }

    .game-card__result {
      font-size: 48px;
      margin: 16px 0;
    }

    .game-card__timer {
      margin: 16px 0 8px;
    }
    .game-card__timer-bar {
      height: 8px;
      background: rgba(0, 0, 0, 0.08);
      border-radius: 999px;
      overflow: hidden;
    }
    .game-card__timer-fill {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, var(--ui-gold), var(--ui-coral));
      transition: width 0.2s linear;
    }

    .game-card button {
      margin-top: 16px;
      min-width: 140px;
      height: 44px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #d4a84b 0%, #c49a38 100%);
      color: #1a1408;
      font: 700 14px/1 var(--font-display);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .game-card button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(201, 162, 39, 0.4);
    }

    /* ============================================
       TOAST NOTIFICATIONS
       ============================================ */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 16px;
      z-index: 150;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }
    .toast {
      padding: 12px 16px;
      border-radius: 12px;
      background: rgba(20, 18, 14, 0.95);
      border: 1px solid rgba(255, 203, 164, 0.3);
      color: #f8f5ef;
      font: 13px/1.4 'Inter', sans-serif;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      animation: toast-in 0.3s ease-out;
      pointer-events: auto;
      max-width: 280px;
    }
    .toast--success { border-left: 4px solid var(--ui-success); }
    .toast--error { border-left: 4px solid var(--ui-error); }
    .toast--info { border-left: 4px solid var(--ui-info); }
    .toast--warning { border-left: 4px solid var(--ui-warning); }
    @keyframes toast-in {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .toast-exit {
      animation: toast-out 0.3s ease-in forwards;
    }
    @keyframes toast-out {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(20px); }
    }

    /* ============================================
       WORLD LOADING
       ============================================ */
    .world-loading {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 400;
      background: radial-gradient(circle at 30% 20%, rgba(253, 248, 237, 0.7), rgba(20, 18, 14, 0.95));
      backdrop-filter: blur(8px);
    }
    .world-loading.open { display: flex; }
    .world-loading__card {
      width: min(440px, calc(100vw - 40px));
      background: rgba(253, 248, 237, 0.98);
      border: 2px solid rgba(198, 152, 49, 0.45);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 24px 60px rgba(25, 20, 10, 0.3);
      text-align: center;
    }
    .world-loading__icon {
      font-size: 48px;
      margin-bottom: 16px;
      animation: spin 2s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .world-loading__title {
      font: 700 22px/1.1 'Cormorant Garamond', serif;
      color: #2c2112;
      margin-bottom: 16px;
    }
    .world-loading__bar {
      height: 8px;
      background: rgba(0, 0, 0, 0.08);
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(163, 128, 40, 0.2);
    }
    .world-loading__fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #e8c860, #d4a830);
      transition: width 0.15s linear;
    }
    .world-loading__text {
      margin-top: 12px;
      font: 14px/1.4 'Crimson Text', serif;
      color: rgba(60, 44, 18, 0.7);
    }

    /* ============================================
       MOBILE CONTROLS
       ============================================ */
    .mobile-controls {
      display: none;
      position: fixed;
      left: 14px;
      right: 14px;
      bottom: 14px;
      z-index: 60;
      pointer-events: none;
    }

    @media (pointer: coarse) {
      .mobile-controls {
        display: flex;
        justify-content: space-between;
        gap: 14px;
      }
      .challenge-panel {
        display: none;
      }
    }

    .mobile-stick {
      width: 140px;
      pointer-events: auto;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
      display: grid;
      justify-items: center;
      gap: 8px;
    }

    .mobile-stick__base {
      width: 120px;
      height: 120px;
      border-radius: 999px;
      background: rgba(20, 18, 14, 0.6);
      border: 2px solid rgba(255, 210, 122, 0.3);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
      position: relative;
      backdrop-filter: blur(12px);
    }

    .mobile-stick__knob {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: rgba(253, 248, 237, 0.95);
      border: 2px solid rgba(198, 152, 49, 0.5);
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .mobile-stick__label {
      font: 800 11px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(253, 248, 237, 0.85);
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }

    .mobile-actions {
      flex: 1;
      max-width: 300px;
      display: grid;
      gap: 8px;
      align-content: end;
      justify-items: end;
      pointer-events: none;
    }

    .mobile-actions > * {
      pointer-events: auto;
    }

    .mobile-btn {
      height: 44px;
      min-width: 100px;
      padding: 0 14px;
      border-radius: 14px;
      border: 1px solid rgba(163, 128, 40, 0.4);
      background: rgba(253, 248, 237, 0.95);
      color: #2c2112;
      font: 800 12px/1 var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(8px);
      transition: all 0.2s ease;
    }
    .mobile-btn:active {
      transform: scale(0.96);
    }

    .mobile-btn--gold {
      border-color: rgba(153, 113, 18, 0.5);
      background: linear-gradient(180deg, #e8c860, #d4a830);
      color: #241a07;
    }

    .mobile-moves {
      display: none;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      width: min(280px, 100%);
      justify-items: stretch;
    }

    .mobile-moves .mobile-btn {
      min-width: 0;
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (pointer: coarse), (max-width: 720px) {
      #hud {
        top: 10px;
        left: 10px;
        right: 10px;
        height: 44px;
        padding: 0 10px;
      }
      .topbar-left {
        gap: 8px;
      }
      .topbar-pills {
        display: none;
      }
      .world-map-panel {
        right: 10px;
        bottom: 80px;
        transform: scale(0.75);
        transform-origin: bottom right;
      }
      .world-map-panel:hover {
        width: 140px;
        opacity: 0.9;
      }
      .interaction-prompt {
        bottom: 180px;
        font-size: 13px;
        padding: 10px 16px;
      }
      .match-controls {
        width: calc(100vw - 20px);
        left: 10px;
        right: 10px;
        transform: none;
        padding: 14px;
      }
      .onboarding-card {
        padding: 20px;
      }
      .onboarding__title {
        font-size: 22px;
      }
      .onboarding__keys {
        gap: 8px;
      }
      .onboarding__key-btn {
        width: 44px;
        height: 44px;
        font-size: 16px;
      }
    }

    /* ============================================
       ACCESSIBILITY
       ============================================ */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    :focus-visible {
      outline: 2px solid var(--ui-gold);
      outline-offset: 2px;
    }

    /* ============================================
       CONTROL HINTS PANEL
       ============================================ */
    .control-hints {
      position: fixed;
      inset: 0;
      background: rgba(15, 12, 8, 0.88);
      z-index: 300;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
    }
    .control-hints[aria-hidden="false"] {
      display: flex;
    }
    .control-hints__content {
      width: min(600px, calc(100vw - 32px));
      background: linear-gradient(145deg, rgba(253, 248, 237, 0.98), rgba(255, 252, 245, 0.95));
      border: 2px solid rgba(201, 162, 39, 0.5);
      border-radius: 20px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);
      padding: 28px;
      color: #2c2416;
    }
    .control-hints h3 {
      margin: 0 0 20px;
      font: 700 24px/1.2 'Cormorant Garamond', serif;
      text-align: center;
      color: #2c2416;
    }
    .control-hints__grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 20px;
    }
    .control-hints__col h4 {
      margin: 0 0 12px;
      font: 700 14px/1 'Inter', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #a68523;
      border-bottom: 1px solid rgba(201, 162, 39, 0.3);
      padding-bottom: 8px;
    }
    .control-hints__row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      font: 14px/1.4 'Crimson Text', serif;
      color: #4a3f32;
    }
    .control-hints__row kbd {
      display: inline-block;
      min-width: 28px;
      padding: 4px 8px;
      background: linear-gradient(180deg, #fff 0%, #f5f0e0 100%);
      border: 1px solid rgba(201, 162, 39, 0.5);
      border-radius: 6px;
      font: 700 12px/1 'IBM Plex Mono', monospace;
      color: #3a2f1a;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .control-hints__note {
      margin: 20px 0 0;
      text-align: center;
      font: 13px/1 'Crimson Text', serif;
      color: #8c7d68;
    }
    .control-hints__note kbd {
      display: inline-block;
      padding: 2px 6px;
      background: rgba(201, 162, 39, 0.2);
      border-radius: 4px;
      font: 700 11px/1 'IBM Plex Mono', monospace;
    }

    @media (max-width: 600px) {
      .control-hints__grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- Screen reader announcements -->
  <div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Canvas -->
  <div class="canvas-shell"><canvas id="scene" aria-label="3D game world"></canvas></div>

  <!-- Onboarding Tutorial -->
  <div id="onboarding-overlay" class="onboarding-overlay" role="dialog" aria-modal="true" aria-labelledby="onboarding-title">
    <div class="onboarding-card">
      <div class="onboarding__progress" id="onboarding-progress">
        <div class="onboarding__dot active" data-step="0"></div>
        <div class="onboarding__dot" data-step="1"></div>
        <div class="onboarding__dot" data-step="2"></div>
        <div class="onboarding__dot" data-step="3"></div>
        <div class="onboarding__dot" data-step="4"></div>
      </div>
      <div id="onboarding-content">
        <!-- Step 0: Welcome -->
        <div class="onboarding__step" data-step="0">
          <div class="onboarding__icon">‚öîÔ∏è</div>
          <h2 class="onboarding__title" id="onboarding-title">Welcome to the Arena</h2>
          <p class="onboarding__desc">Challenge AI agents and other players to betting duels. Let's learn the basics!</p>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Start Tutorial</button>
          </div>
        </div>
        <!-- Step 1: Movement -->
        <div class="onboarding__step" data-step="1" style="display:none;">
          <div class="onboarding__icon">üö∂</div>
          <h2 class="onboarding__title">Movement</h2>
          <p class="onboarding__desc">Use WASD or arrow keys to move around the arena.</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">W</div>
              <span class="onboarding__key-label">Forward</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">A</div>
              <span class="onboarding__key-label">Left</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">S</div>
              <span class="onboarding__key-label">Back</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">D</div>
              <span class="onboarding__key-label">Right</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Next</button>
          </div>
        </div>
        <!-- Step 2: Camera -->
        <div class="onboarding__step" data-step="2" style="display:none;">
          <div class="onboarding__icon">üì∑</div>
          <h2 class="onboarding__title">Camera Control</h2>
          <p class="onboarding__desc">Hold <strong>Shift + Right-drag</strong> to orbit the camera. Press <strong>R</strong> to reset behind your character.</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">R</div>
              <span class="onboarding__key-label">Reset Cam</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Next</button>
          </div>
        </div>
        <!-- Step 3: Challenges -->
        <div class="onboarding__step" data-step="3" style="display:none;">
          <div class="onboarding__icon">‚öîÔ∏è</div>
          <h2 class="onboarding__title">Challenges</h2>
          <p class="onboarding__desc">When near another player, press <strong>E</strong> to interact. Send challenges with <strong>C</strong>, respond with <strong>Y/N</strong>.</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">E</div>
              <span class="onboarding__key-label">Interact</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">C</div>
              <span class="onboarding__key-label">Challenge</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">Y/N</div>
              <span class="onboarding__key-label">Respond</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Next</button>
          </div>
        </div>
        <!-- Step 4: Games -->
        <div class="onboarding__step" data-step="4" style="display:none;">
          <div class="onboarding__icon">üéÆ</div>
          <h2 class="onboarding__title">Play!</h2>
          <p class="onboarding__desc">Rock Paper Scissors: <strong>1/2/3</strong> ¬∑ Coin Flip: <strong>H/T</strong>. Good luck!</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">1</div>
              <span class="onboarding__key-label">Rock</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">2</div>
              <span class="onboarding__key-label">Paper</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">3</div>
              <span class="onboarding__key-label">Scissors</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="start">Enter Arena</button>
          </div>
          <p class="onboarding__skip">Press <a id="skip-tutorial">Skip Tutorial</a> to start immediately</p>
        </div>
      </div>
    </div>
  </div>

  <!-- World Loading -->
  <div id="world-loading" class="world-loading" aria-hidden="true">
    <div class="world-loading__card">
      <div class="world-loading__icon">üåç</div>
      <div class="world-loading__title">Loading world‚Ä¶</div>
      <div class="world-loading__bar"><div id="world-loading-bar" class="world-loading__fill"></div></div>
      <div id="world-loading-text" class="world-loading__text">Preparing assets</div>
    </div>
  </div>

  <!-- Top HUD -->
  <header id="hud" role="banner">
    <div class="topbar-left">
      <i class="topbar-avatar" aria-hidden="true"></i>
      <span id="topbar-name" class="topbar-name">Loading...</span>
      <div class="topbar-pills">
        <span id="topbar-wallet" class="topbar-pill wallet" title="Wallet balance">$0</span>
        <span id="topbar-streak" class="topbar-pill streak" title="Win streak">üî• 0</span>
      </div>
    </div>
    <button id="topbar-menu" class="menu-ghost" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="topbar-menu-pop">‚ò∞</button>
  </header>

  <!-- Menu Dropdown -->
  <nav id="topbar-menu-pop" class="menu-pop" role="menu" aria-hidden="true">
    <button id="menu-dashboard" type="button" role="menuitem">üìä Dashboard</button>
    <button id="menu-viewer" type="button" role="menuitem">üó∫Ô∏è World Viewer</button>
    <button id="menu-logout" type="button" role="menuitem">üö™ Logout</button>
  </nav>

  <!-- Interaction Prompt -->
  <div id="interaction-prompt" class="interaction-prompt" role="status" aria-live="polite"></div>

  <!-- Interaction Card -->
  <section id="interaction-card" class="interaction-card" aria-hidden="true" role="dialog" aria-labelledby="interaction-title">
    <div class="interaction-card__head">
      <div class="interaction-card__title" id="interaction-title">Challenge</div>
      <button id="interaction-close" class="interaction-card__close" type="button" aria-label="Close">√ó</button>
    </div>
    <div class="interaction-card__body">
      <div id="station-ui" class="station-ui" aria-live="polite" hidden></div>
      <div class="interaction-row">
        <label for="interaction-game">Game</label>
        <select id="interaction-game">
          <option value="rps">Rock Paper Scissors</option>
          <option value="coinflip">Coin Flip</option>
        </select>
      </div>
      <div class="interaction-row">
        <label for="interaction-wager">Wager (each)</label>
        <input id="interaction-wager" type="number" min="0" max="10000" step="1" value="1" aria-describedby="wager-hint" />
      </div>
      <div class="interaction-actions">
        <button id="interaction-send" class="btn-gold" type="button">Send Challenge</button>
        <button id="interaction-open-desk" class="btn-ghost" type="button">Desk</button>
      </div>
      <p id="wager-hint" class="interaction-hint">
        <span class="interaction-prompt__key">0</span> free ¬∑
        <span class="interaction-prompt__key">E</span> close ¬∑
        <span class="interaction-prompt__key">Tab</span> switch ¬∑
        <span class="interaction-prompt__key">Y/N</span> respond
      </p>
    </div>
  </section>

  <!-- Challenge Desk Panel (Secondary) -->
  <aside class="challenge-panel" id="context-panel" aria-label="Challenge desk">
    <div class="challenge-panel__head">
      <h2>Challenge Desk</h2>
      <button id="desk-toggle" class="desk-toggle" type="button">Collapse</button>
    </div>
    <div class="challenge-panel__body" id="desk-body">
      <div class="pill-row">
        <span class="pill">C send</span>
        <span class="pill">Y/N respond</span>
        <span class="pill">1/2/3 RPS</span>
        <span class="pill">H/T coin</span>
      </div>
      <div id="challenge-status-line" class="status-line" role="status">Find a nearby target to challenge.</div>
      <div class="row">
        <label for="challenge-target">Nearby target</label>
        <select id="challenge-target" aria-label="Select nearby target"></select>
      </div>
      <div class="challenge-grid">
        <div>
          <label for="challenge-game">Game</label>
          <select id="challenge-game">
            <option value="rps">Rock Paper Scissors</option>
            <option value="coinflip">Coin Flip</option>
          </select>
        </div>
        <div>
          <label for="challenge-wager">Wager</label>
          <input id="challenge-wager" type="number" min="0" max="10000" step="1" value="1">
        </div>
      </div>
      <div class="challenge-actions">
        <button id="challenge-send" type="button">Send Challenge</button>
        <button id="challenge-cancel" type="button">Clear</button>
      </div>
      <div class="challenge-actions">
        <button id="challenge-accept" type="button">Accept (Y)</button>
        <button id="challenge-decline" type="button">Decline (N)</button>
      </div>
    </div>
  </aside>

  <!-- World Map -->
  <aside class="world-map-panel" aria-label="Arena minimap">
    <div class="world-map-title">
      <span>Map</span>
      <span id="map-coords">x:0 z:0</span>
    </div>
    <canvas id="world-map" width="220" height="170" aria-label="World map showing player positions"></canvas>
    <div class="map-legend">
      <span><i class="map-dot" style="background:#2f6dff" aria-hidden="true"></i>You</span>
      <span><i class="map-dot" style="background:#b4792a" aria-hidden="true"></i>Agent</span>
      <span><i class="map-dot" style="background:#4f8a63" aria-hidden="true"></i>Human</span>
    </div>
  </aside>

  <!-- Control Hints Panel -->
  <div id="control-hints" class="control-hints" aria-hidden="true">
    <div class="control-hints__content">
      <h3>Controls</h3>
      <div class="control-hints__grid">
        <div class="control-hints__col">
          <h4>Movement</h4>
          <div class="control-hints__row"><kbd>W A S D</kbd> Move</div>
          <div class="control-hints__row"><kbd>Shift+Drag</kbd> Orbit camera</div>
          <div class="control-hints__row"><kbd>Scroll</kbd> Zoom</div>
          <div class="control-hints__row"><kbd>R</kbd> Reset camera</div>
        </div>
        <div class="control-hints__col">
          <h4>Interaction</h4>
          <div class="control-hints__row"><kbd>E</kbd> Interact with nearby</div>
          <div class="control-hints__row"><kbd>C</kbd> Send challenge</div>
          <div class="control-hints__row"><kbd>Tab</kbd> Switch target</div>
          <div class="control-hints__row"><kbd>V</kbd> View profile</div>
        </div>
        <div class="control-hints__col">
          <h4>Match</h4>
          <div class="control-hints__row"><kbd>Y</kbd> Accept challenge</div>
          <div class="control-hints__row"><kbd>N</kbd> Decline challenge</div>
          <div class="control-hints__row"><kbd>O</kbd> Counter-offer</div>
          <div class="control-hints__row"><kbd>1 2 3</kbd> RPS moves</div>
          <div class="control-hints__row"><kbd>H T</kbd> Coin flip</div>
        </div>
      </div>
      <p class="control-hints__note">Press <kbd>?</kbd> to close</p>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container" aria-live="polite"></div>

  <!-- Game Modal -->
  <div id="game-modal" class="game-modal" role="dialog" aria-modal="true" aria-labelledby="game-title">
    <div class="game-card">
      <h3 id="game-title">Match</h3>
      <p id="game-players">Waiting...</p>
      <p id="game-status">Preparing challenge.</p>
      <p id="game-detail"></p>
      <div id="challenge-timer-wrap" class="game-card__timer" style="display:none;">
        <div class="game-card__timer-bar">
          <div id="challenge-timer-bar" class="game-card__timer-fill"></div>
        </div>
      </div>
      <button id="game-close" type="button">Close</button>
    </div>
  </div>

  <!-- Match Controls -->
  <section id="match-controls" class="match-controls" aria-label="Match controls">
    <div class="match-controls__header">
      <div class="match-controls__title" id="match-controls-title">Match</div>
      <span id="match-controls-badge" class="match-controls__badge match-controls__badge--active">Active</span>
    </div>
    <div class="match-controls__status" id="match-controls-status">No active match.</div>
    <div class="match-controls__actions" id="match-controls-actions"></div>
    <div id="match-counter-offer" class="match-controls__counter">
      <input id="counter-wager" type="number" min="0" max="10000" step="1" value="1" aria-label="Counter wager amount" />
      <button id="counter-send" type="button">Counter</button>
    </div>
  </section>

  <!-- Mobile Controls -->
  <section id="mobile-controls" class="mobile-controls" aria-hidden="true">
    <div id="mobile-stick" class="mobile-stick" role="application" aria-label="Movement joystick">
      <div class="mobile-stick__base">
        <div id="mobile-stick-knob" class="mobile-stick__knob"></div>
      </div>
      <div class="mobile-stick__label">Move</div>
    </div>
    <div class="mobile-actions" aria-label="Action buttons">
      <button id="mobile-interact" type="button" class="mobile-btn mobile-btn--gold">Interact</button>
      <button id="mobile-send" type="button" class="mobile-btn mobile-btn--gold">Send</button>
      <button id="mobile-accept" type="button" class="mobile-btn">Accept</button>
      <button id="mobile-decline" type="button" class="mobile-btn">Decline</button>
      <button id="mobile-counter" type="button" class="mobile-btn">Counter</button>
      <div id="mobile-moves" class="mobile-moves">
        <button id="mobile-move-1" type="button" class="mobile-btn">Rock</button>
        <button id="mobile-move-2" type="button" class="mobile-btn">Paper</button>
        <button id="mobile-move-3" type="button" class="mobile-btn">Scissors</button>
        <button id="mobile-move-h" type="button" class="mobile-btn">Heads</button>
        <button id="mobile-move-t" type="button" class="mobile-btn">Tails</button>
      </div>
    </div>
  </section>

  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.172.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.172.0/examples/jsm/"
      }
    }
  </script>
  <script type="module" src="/js/play.js"></script>
</body>
</html>
