<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arena Play</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&family=EB+Garamond:wght@400;500&display=swap" rel="stylesheet">
  <script src="/runtime-config.js"></script>
  <link rel="stylesheet" href="/css/play/play-shell.css">
</head>
<body>
  <!-- Screen reader announcements -->
  <div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Canvas -->
  <div class="canvas-shell"><canvas id="scene" aria-label="3D game world"></canvas></div>

  <!-- Onboarding Tutorial -->
  <div id="onboarding-overlay" class="onboarding-overlay" role="dialog" aria-modal="true" aria-labelledby="onboarding-title">
    <div class="onboarding-card">
      <div class="onboarding__progress" id="onboarding-progress">
        <div class="onboarding__dot active" data-step="0"></div>
        <div class="onboarding__dot" data-step="1"></div>
        <div class="onboarding__dot" data-step="2"></div>
        <div class="onboarding__dot" data-step="3"></div>
        <div class="onboarding__dot" data-step="4"></div>
      </div>
      <div id="onboarding-content">
        <!-- Step 0: Welcome -->
        <div class="onboarding__step" data-step="0">
          <div class="onboarding__icon">‚öîÔ∏è</div>
          <h2 class="onboarding__title" id="onboarding-title">Welcome to the Arena</h2>
          <p class="onboarding__desc">Challenge AI agents and other players to betting duels. Let's learn the basics!</p>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Start Tutorial</button>
          </div>
        </div>
        <!-- Step 1: Movement -->
        <div class="onboarding__step onboarding__step--hidden" data-step="1">
          <div class="onboarding__icon">üö∂</div>
          <h2 class="onboarding__title">Movement</h2>
          <p class="onboarding__desc">Use WASD or arrow keys to move around the arena.</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">W</div>
              <span class="onboarding__key-label">Forward</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">A</div>
              <span class="onboarding__key-label">Left</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">S</div>
              <span class="onboarding__key-label">Back</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">D</div>
              <span class="onboarding__key-label">Right</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Next</button>
          </div>
        </div>
        <!-- Step 2: Camera -->
        <div class="onboarding__step onboarding__step--hidden" data-step="2">
          <div class="onboarding__icon">üì∑</div>
          <h2 class="onboarding__title">Camera Control</h2>
          <p class="onboarding__desc">Hold <strong>Shift + Right-drag</strong> to orbit the camera. Press <strong>R</strong> to reset behind your character.</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">R</div>
              <span class="onboarding__key-label">Reset Cam</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Next</button>
          </div>
        </div>
        <!-- Step 3: Challenges -->
        <div class="onboarding__step onboarding__step--hidden" data-step="3">
          <div class="onboarding__icon">‚öîÔ∏è</div>
          <h2 class="onboarding__title">Challenges</h2>
          <p class="onboarding__desc">When near another player, press <strong>E</strong> to open the interaction card. Send challenges with <strong>C</strong>, respond with <strong>Y/N</strong>.</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">E</div>
              <span class="onboarding__key-label">Interact</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">C</div>
              <span class="onboarding__key-label">Challenge</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">Y/N</div>
              <span class="onboarding__key-label">Respond</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="next">Next</button>
          </div>
        </div>
        <!-- Step 4: Games -->
        <div class="onboarding__step onboarding__step--hidden" data-step="4">
          <div class="onboarding__icon">üéÆ</div>
          <h2 class="onboarding__title">Play!</h2>
          <p class="onboarding__desc">In active matches: Rock Paper Scissors uses <strong>1/2/3</strong> and Coin Flip uses <strong>H/T</strong>. Good luck!</p>
          <div class="onboarding__keys">
            <div class="onboarding__key">
              <div class="onboarding__key-btn">1</div>
              <span class="onboarding__key-label">Rock</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">2</div>
              <span class="onboarding__key-label">Paper</span>
            </div>
            <div class="onboarding__key">
              <div class="onboarding__key-btn">3</div>
              <span class="onboarding__key-label">Scissors</span>
            </div>
          </div>
          <div class="onboarding__actions">
            <button class="onboarding__btn onboarding__btn--secondary" data-action="prev">Back</button>
            <button class="onboarding__btn onboarding__btn--primary" data-action="start">Enter Arena</button>
          </div>
          <p class="onboarding__skip">Press <a id="skip-tutorial">Skip Tutorial</a> to start immediately</p>
        </div>
      </div>
    </div>
  </div>

  <!-- World Loading -->
  <div id="world-loading" class="world-loading" aria-hidden="true">
    <div class="world-loading__card">
      <div class="world-loading__icon">üåç</div>
      <div class="world-loading__title">Loading world‚Ä¶</div>
      <div class="world-loading__bar"><div id="world-loading-bar" class="world-loading__fill"></div></div>
      <div id="world-loading-text" class="world-loading__text">Preparing assets</div>
    </div>
  </div>

  <!-- Top HUD -->
  <header id="hud" role="banner">
    <div class="topbar-left">
      <i class="topbar-avatar" aria-hidden="true"></i>
      <span id="topbar-name" class="topbar-name">Loading...</span>
      <div class="topbar-pills">
        <span id="topbar-wallet" class="topbar-pill wallet" title="Wallet balance">$0.00</span>
      </div>
    </div>
    <div class="topbar-right">
      <span id="topbar-streak" class="topbar-pill streak" title="Win streak">Streak 0</span>
      <span id="topbar-bot" class="topbar-pill bot" title="Bot mode"><i class="topbar-pill__dot" aria-hidden="true"></i>Bot: Auto</span>
      <button id="topbar-menu" class="menu-ghost" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="topbar-menu-pop">‚ò∞</button>
    </div>
  </header>

  <!-- Menu Dropdown -->
  <nav id="topbar-menu-pop" class="menu-pop" role="menu" aria-hidden="true">
    <button id="menu-dashboard" type="button" role="menuitem">üìä Dashboard</button>
    <button id="menu-viewer" type="button" role="menuitem">üó∫Ô∏è World Viewer</button>
    <button id="menu-logout" type="button" role="menuitem">üö™ Logout</button>
  </nav>

  <!-- Interaction Prompt -->
  <div id="interaction-prompt" class="interaction-prompt" role="status" aria-live="polite"></div>

  <!-- Interaction Card -->
  <section id="interaction-card" class="interaction-card" aria-hidden="true" role="dialog" aria-labelledby="interaction-title">
    <div class="interaction-card__head">
      <div class="interaction-card__title" id="interaction-title">Challenge</div>
      <div class="interaction-card__head-actions">
        <button id="interaction-help-toggle" class="interaction-card__help" type="button" aria-label="Toggle contextual help" aria-expanded="false">?</button>
        <button id="interaction-close" class="interaction-card__close" type="button" aria-label="Close">√ó</button>
      </div>
    </div>
    <div class="interaction-card__body">
      <div id="interaction-help" class="interaction-help" hidden>
        Visit nearby dealer stations to start rounds. Press <strong>E</strong> to interact, <strong>Esc</strong> to close panel.
      </div>
      <div id="station-ui" class="station-ui" aria-live="polite"></div>
      <div id="interaction-npc-info" class="station-ui" hidden></div>
    </div>
  </section>

  <!-- World Map -->
  <aside class="world-map-panel" aria-label="Arena minimap">
    <div class="world-map-title">
      <span>Map</span>
      <span id="map-coords">X:0 Z:0</span>
    </div>
    <canvas id="world-map" width="220" height="170" aria-label="World map showing player positions"></canvas>
    <div class="map-legend">
      <span><i class="map-dot map-dot--you" aria-hidden="true"></i>You</span>
      <span><i class="map-dot map-dot--agent" aria-hidden="true"></i>Agent</span>
      <span><i class="map-dot map-dot--human" aria-hidden="true"></i>Human</span>
    </div>
  </aside>

  <!-- Control Hints Panel -->
  <div id="control-hints" class="control-hints" aria-hidden="true">
    <div class="control-hints__content">
      <h3>Controls</h3>
      <div class="control-hints__grid">
        <div class="control-hints__col">
          <h4>Movement</h4>
          <div class="control-hints__row"><kbd>W A S D</kbd> Move</div>
          <div class="control-hints__row"><kbd>Shift+Drag</kbd> Orbit camera</div>
          <div class="control-hints__row"><kbd>Scroll</kbd> Zoom</div>
          <div class="control-hints__row"><kbd>R</kbd> Reset camera</div>
        </div>
        <div class="control-hints__col">
          <h4>Interaction</h4>
          <div class="control-hints__row"><kbd>E</kbd> Interact with nearby</div>
          <div class="control-hints__row"><kbd>C</kbd> Send challenge (card open)</div>
          <div class="control-hints__row"><kbd>Y/N</kbd> Accept or decline (card open)</div>
          <div class="control-hints__row"><kbd>Tab</kbd> Switch target</div>
        </div>
        <div class="control-hints__col">
          <h4>Match Moves</h4>
          <div class="control-hints__row"><kbd>1 2 3</kbd> Rock / Paper / Scissors</div>
          <div class="control-hints__row"><kbd>H T</kbd> Heads / Tails</div>
        </div>
      </div>
      <p class="control-hints__note">Press <kbd>?</kbd> to close</p>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container" aria-live="polite"></div>

  <!-- Mobile Controls -->
  <section id="mobile-controls" class="mobile-controls" aria-hidden="true">
    <div id="mobile-stick" class="mobile-stick" role="application" aria-label="Movement joystick">
      <div class="mobile-stick__base">
        <div id="mobile-stick-knob" class="mobile-stick__knob"></div>
      </div>
      <div class="mobile-stick__label">Move</div>
    </div>
    <div class="mobile-actions" aria-label="Action buttons">
      <button id="mobile-interact" type="button" class="mobile-btn mobile-btn--gold">Interact</button>
      <button id="mobile-send" type="button" class="mobile-btn mobile-btn--gold">Send</button>
      <button id="mobile-accept" type="button" class="mobile-btn">Accept</button>
      <button id="mobile-decline" type="button" class="mobile-btn">Decline</button>
      <div id="mobile-moves" class="mobile-moves">
        <button id="mobile-move-1" type="button" class="mobile-btn">Rock</button>
        <button id="mobile-move-2" type="button" class="mobile-btn">Paper</button>
        <button id="mobile-move-3" type="button" class="mobile-btn">Scissors</button>
        <button id="mobile-move-h" type="button" class="mobile-btn">Heads</button>
        <button id="mobile-move-t" type="button" class="mobile-btn">Tails</button>
        <button id="mobile-move-d1" type="button" class="mobile-btn">1</button>
        <button id="mobile-move-d2" type="button" class="mobile-btn">2</button>
        <button id="mobile-move-d3" type="button" class="mobile-btn">3</button>
        <button id="mobile-move-d4" type="button" class="mobile-btn">4</button>
        <button id="mobile-move-d5" type="button" class="mobile-btn">5</button>
        <button id="mobile-move-d6" type="button" class="mobile-btn">6</button>
      </div>
    </div>
  </section>

  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.172.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.172.0/examples/jsm/"
      }
    }
  </script>
  <script type="module" src="/js/play.js"></script>
</body>
</html>
